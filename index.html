<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NON-ESCALATOR ENM RELATIONSHIP MENU</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0 auto;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%);
            min-height: 100vh;
            line-height: 1.4;
            max-width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #495057;
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 1.6em;
            padding: 0 10px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(255,255,255,0.8);
            letter-spacing: -0.5px;
        }
        
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border: 2px solid #6c757d;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.9em;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .language-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border-color: #495057;
        }
        
        .partner-names {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1em;
            color: #495057;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }
        
        .partner-names span {
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .partner-names input[type="text"] {
            width: 100%;
            max-width: 200px;
            padding: 14px 18px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            font-size: 16px;
            text-align: center;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            font-weight: 500;
            color: #495057;
        }
        
        .partner-names input[type="text"]:focus {
            outline: none;
            background: rgba(255,255,255,1);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border-color: #6c757d;
        }
        
        .legend {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 2px solid rgba(108,117,125,0.2);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            font-size: 1em;
            text-align: center;
        }
        
        .legend span {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1em;
            color: #495057;
        }
        
        .section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(15px);
            padding: 25px 20px;
            margin-bottom: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 2px solid rgba(108,117,125,0.2);
        }
        
        h2 {
            color: #495057;
            margin: 0 0 25px 0;
            border-bottom: 2px solid rgba(108,117,125,0.2);
            padding-bottom: 15px;
            font-size: 1.3em;
            text-align: left; /* 从center改为left */
            font-weight: 700;
            letter-spacing: -0.3px;
        }
        
        .item {
            margin: 18px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px 18px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 12px;
            border: 2px solid rgba(108,117,125,0.15);
            transition: all 0.3s ease;
        }
        
        .item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            border-color: rgba(108,117,125,0.3);
        }
        
        .item-text {
            font-size: 1.1em;
            color: #495057;
            font-weight: 500;
            text-align: left; /* 从center改为left */
            line-height: 1.5;
        }
        
        .info-banner {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(15px);
            padding: 15px 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 2px solid rgba(108,117,125,0.2);
            font-size: 0.95em;
            color: #495057;
            line-height: 1.5;
            text-align: left; /* 已经是left，保持不变 */
        }
        
        h2 {
            color: #495057;
            margin: 0 0 25px 0;
            border-bottom: 2px solid rgba(108,117,125,0.2);
            padding-bottom: 15px;
            font-size: 1.3em;
            text-align: left; /* 从center改为left */
            font-weight: 700;
            letter-spacing: -0.3px;
        }
        
        .options {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .option {
            cursor: pointer;
            padding: 10px 12px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1.2em;
            font-weight: 600;
            min-width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: linear-gradient(145deg, #fff, #f8f9fa);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            color: #495057;
        }
        
        .option:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border-color: #6c757d;
        }
        
        .option:active {
            transform: translateY(0) scale(0.98);
        }
        
        .option.selected {
            background: linear-gradient(135deg, #6c757d, #495057) !important;
            color: #fff !important;
            border-color: #495057 !important;
            box-shadow: 0 6px 20px rgba(108,117,125,0.4) !important;
            transform: translateY(-2px) scale(1.1);
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .custom-item input {
            border: 2px solid rgba(108,117,125,0.3);
            border-radius: 12px;
            padding: 14px 16px;
            width: 100%;
            font-size: 16px;
            background: rgba(255,255,255,0.9);
            transition: all 0.3s ease;
            font-weight: 500;
            color: #495057;
        }
        
        .custom-item input:focus {
            outline: none;
            border-color: #6c757d;
            background: rgba(255,255,255,1);
            box-shadow: 0 0 0 3px rgba(108,117,125,0.1);
            transform: translateY(-1px);
        }
        
        .export-buttons {
            position: sticky;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 20px 15px;
            margin: 30px -15px -15px -15px;
            border-top: 2px solid rgba(108,117,125,0.2);
            box-shadow: 0 -8px 32px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: row; /* 改为横向排列 */
            justify-content: center; /* 居中对齐 */
            gap: 10px; /* 减小间距 */
        }
        
        .export-buttons button {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 12px 16px; /* 减小内边距 */
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9em; /* 减小字体大小 */
            font-weight: 600;
            min-height: 44px; /* 减小最小高度 */
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 4px 15px rgba(108,117,125,0.3);
            letter-spacing: 0.5px;
            flex: 1; /* 让按钮平均分配空间 */
            max-width: 45%; /* 限制最大宽度 */
        }
        
        /* Desktop styles */
        @media (min-width: 768px) {
            body {
                max-width: 800px;
                margin: 0 auto;
                padding: 30px;
            }
            
            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }
            
            .partner-names {
                flex-direction: row;
                justify-content: center;
                align-items: center;
                gap: 15px;
            }
            
            .legend {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
            }
            
            .legend span {
                margin-right: 0;
            }
            
            .item {
                flex-direction: row;
                align-items: center;
                gap: 15px;
                padding: 12px 15px;
            }
            
            .item-text {
                flex: 1;
            }
            
            .options {
                justify-content: flex-end;
            }
            
            .export-buttons {
                position: static;
                flex-direction: row;
                justify-content: center;
                margin: 30px 0 0 0;
                padding: 20px;
                border-top: none;
                box-shadow: none;
                background-color: transparent;
                gap: 15px; /* 恢复间距 */
            }
            
            .export-buttons button {
                min-height: auto;
                padding: 12px 24px;
                font-size: 1em; /* 恢复字体大小 */
                flex: none; /* 取消弹性布局 */
                max-width: none; /* 取消最大宽度限制 */
            }
        }
        
        @media print {
            .option.selected {
                border: 2px solid #000 !important;
                font-weight: bold;
                background-color: #000 !important;
                color: #fff !important;
            }
            
            .export-buttons, .language-toggle, .info-banner {
                display: none;
            }
        }
    </style>
</head>
<body>
    <button class="language-toggle" onclick="toggleLanguage()">中文</button>
    
    <h1 id="title">NON-ESCALATOR RELATIONSHIP MENU</h1>
    <div class="partner-names">
        <input type="text" id="partner1" placeholder="Partner 1 Name">
        <span>&</span>
        <input type="text" id="partner2" placeholder="Partner 2 Name">
    </div>
    
    <div class="info-banner">
        <p id="info-text"><strong>Note:</strong> This menu is a starting point for conversation, not a fixed list of commitments. All items can be customized to your relationship. Double-click any item to edit it.</p>
        <p id="deescalation-text"><strong>Relationship Fluidity:</strong> Relationships can naturally evolve over time, including becoming less intense or transitioning to friendship. This is a normal part of relating and doesn't represent failure.</p>
    </div>
    
    <div class="legend">
        <span id="legend-must">■ Must Have</span>
        <span id="legend-like">♥ Like to Have</span>
        <span id="legend-maybe">? Maybe</span>
        <span id="legend-off">✘ Off Limits</span>
    </div>

    <div class="section" id="connection">
        <h2 id="connection-title">CONNECTION & AGREEMENTS</h2>
        <!-- Items will be dynamically generated by JavaScript -->
    </div>

    <div class="section" id="emotional">
        <h2 id="emotional-title">EMOTIONAL INTIMACY</h2>
    </div>

    <div class="section" id="social">
        <h2 id="social-title">SOCIAL INTEGRATION</h2>
    </div>

    <div class="section" id="physical">
        <h2 id="physical-title">PHYSICAL INTIMACY & SEXUAL HEALTH</h2>
    </div>

    <div class="section" id="communication">
        <h2 id="communication-title">COMMUNICATION</h2>
    </div>

    <div class="section" id="quality">
        <h2 id="quality-title">QUALITY TIME</h2>
    </div>

    <div class="section" id="financial">
        <h2 id="financial-title">FINANCIAL MATTERS</h2>
    </div>

    <div class="section" id="autonomy">
        <h2 id="autonomy-title">AUTONOMY</h2>
    </div>

    <div class="section" id="miscellaneous">
        <h2 id="miscellaneous-title">MISCELLANEOUS</h2>
    </div>

    <div class="export-buttons">
        <button onclick="window.print()" id="export-pdf">Export to PDF</button>
        <button onclick="exportToExcel()" id="export-excel">Export to Excel</button>
    </div>

    <script>
        let currentLanguage = 'en';
        
        const translations = {
            en: {
                title: 'NON-ESCALATOR RELATIONSHIP MENU',
                partner1: 'Partner 1 Name',
                partner2: 'Partner 2 Name',
                legendMust: '■ Must Have',
                legendLike: '♥ Like to Have',
                legendMaybe: '? Maybe',
                legendOff: '✘ Off Limits',
                connectionTitle: 'CONNECTION & AGREEMENTS',
                emotionalTitle: 'EMOTIONAL INTIMACY',
                socialTitle: 'SOCIAL INTEGRATION',
                physicalTitle: 'PHYSICAL INTIMACY & SEXUAL HEALTH',
                communicationTitle: 'COMMUNICATION',
                qualityTitle: 'QUALITY TIME',
                financialTitle: 'FINANCIAL MATTERS',
                autonomyTitle: 'AUTONOMY',
                miscellaneousTitle: 'MISCELLANEOUS',
                exportPdf: 'Export to PDF',
                exportExcel: 'Export to Excel',
                customPlaceholder: 'Add your own item...',
                infoText: '<strong>Note:</strong> This menu is a starting point for conversation, not a fixed list of commitments. All items can be customized to your relationship. Double-click any item to edit it.',
                deescalationText: '<strong>Relationship Fluidity:</strong> Relationships can naturally evolve over time, including becoming less intense or transitioning to friendship. This is a normal part of relating and doesn\'t represent failure.'
            },
            zh: {
                title: '去阶梯化关系协定菜单',
                partner1: '伴侣1姓名',
                partner2: '伴侣2姓名',
                legendMust: '■ 必须有',
                legendLike: '♥ 希望有',
                legendMaybe: '? 也许',
                legendOff: '✘ 禁止',
                connectionTitle: '连接与协定',
                emotionalTitle: '情感亲密度',
                socialTitle: '社交融合',
                physicalTitle: '身体亲密与性健康',
                communicationTitle: '沟通方式',
                qualityTitle: '优质时光',
                financialTitle: '财务事项',
                autonomyTitle: '个人自主',
                miscellaneousTitle: '其他事项',
                exportPdf: '导出为PDF',
                exportExcel: '导出为Excel',
                customPlaceholder: '添加您自己的项目...',
                infoText: '<strong>注意：</strong>此菜单是对话的起点，而非固定的承诺清单。所有条目都可以根据你们的关系进行自定义。双击任何条目可以编辑。',
                deescalationText: '<strong>关系流动性：</strong>关系可以随时间自然演变，包括变得不那么紧密或转变为友谊。这是关系的正常部分，并不代表失败。'
            }
        };

        const menuData = {
            en: {
                connection: [
                    'Transparency about other partners/dating apps (weekly updates)',
                    'Consistency in planned meet-ups (2-3 times per week)',
                    'Honesty about feelings & boundaries (ongoing dialogue)',
                    'Safer-sex agreements (barriers with new partners, testing every 3 months)',
                    'Regular check-ins on our agreements (monthly)',
                    'Emotional responsibility (owning impact without blame)',
                    'Clarity on exclusivity expectations (e.g., none/partial/specific activities)',
                    'Comfort with relationship evolution (including de-escalation)',
                    'Respecting each other\'s pace of emotional connection',
                    ''
                ],
                emotional: [
                    'Sharing joys & frustrations (daily/weekly check-ins)',
                    'Offering support during rough days (as needed, within capacity)',
                    'Willingness to be vulnerable (at comfortable pace)',
                    'Sharing personal growth goals (monthly reflections)',
                    'Check-ins about feelings after seeing others (within 24-48 hours)',
                    'Respecting emotional boundaries & space (asking before deep discussions)',
                    'Discussing mental-health needs (proactive communication)',
                    'Using chosen endearments/pet names (establishing preferences)',
                    'Celebrating each other\'s successes (active acknowledgment)',
                    'Space for processing jealousy without judgment',
                    ''
                ],
                social: [
                    'Hanging out with mutual friends (frequency preferences)',
                    'Meeting metamours if comfortable (no timeline pressure)',
                    'Casual group events/parties together (monthly)',
                    'Social media boundaries (comfort with tagging/posting)',
                    'Attending festivals/concerts as a group (seasonal)',
                    'Privacy boundaries with family/professional circles',
                    'Vacationing with friend groups (annual/semi-annual)',
                    'How we introduce each other to others (preferred terms)',
                    'Comfort level with PDA in different social contexts',
                    ''
                ],
                autonomy: [
                    'Maintaining independent friendships (weekly solo social time)',
                    'Supporting each other\'s personal goals/careers (active encouragement)',
                    'Balance of together & alone time (2:1 ratio, etc.)',
                    'Freedom to travel or move independently (communication expectations)',
                    'Equal say in relationship decisions (consensus-based approach)',
                    'Personal space needs (hours/days per week)',
                    'Independent decision-making boundaries (what requires consultation)',
                    'Comfort with spontaneous plans with others',
                    ''
                ],
                miscellaneous: [
                    'Pet-sitting or plant-sitting for each other (as needed)',
                    'Creative collaborations (music, art, projects)',
                    'Sharing playlists/book recommendations (frequency)',
                    'Wellness support (joint workouts, meditation practice)',
                    'Skill sharing and learning together (monthly skill exchange)',
                    'Spiritual or mindfulness practices (respecting differences)',
                    'Environmental/lifestyle compatibility (cleaning, sleep habits)',
                    ''
                ],
                physical: [
                    'Kissing/cuddling comfort levels and frequency',
                    'Manual/oral sex boundaries and preferences',
                    'Penetrative sex frequency and boundaries',
                    'Exploring kinks/fantasies (communication process)',
                    'Mutual masturbation or toy play comfort',
                    'STI testing schedule (every 3-6 months)',
                    'Barrier use agreements (with whom, for what activities)',
                    'Sleepover frequency (weekly, monthly, etc.)',
                    'Consent & comfort check-ins during intimacy (verbal/non-verbal)',
                    'Aftercare needs and preferences (touch, space, conversation)',
                    'Physical affection in public settings (boundaries)',
                    ''
                ],
                communication: [
                    'Text check-ins (daily, every few days, etc.)',
                    'Video/voice calls when apart (frequency expectations)',
                    'Sharing interests and daily experiences (depth preferences)',
                    'Debriefing after dates with others (detail level, timing)',
                    'Conflict resolution approach (cooling off period, format)',
                    'Calendar sharing for scheduling (digital tools, update frequency)',
                    'Honesty delivery method (direct, gentle, written)',
                    'Response time expectations (urgent vs. casual messages)',
                    'Communication during busy periods (minimum check-ins)',
                    'Language for expressing needs vs. demands',
                    ''
                ],
                quality: [
                    'Scheduled date nights (weekly, bi-weekly)',
                    'Spontaneous hangouts (comfort with last-minute plans)',
                    'Shared hobbies practice (climbing, gaming, music - frequency)',
                    'Weekend trips frequency (monthly, quarterly)',
                    'Home activities (cooking, movies - weekly rotation)',
                    'Learning together (workshops, classes - quarterly)',
                    'Special occasion celebrations (birthdays, anniversaries)',
                    'Trying new experiences together (monthly adventure)',
                    ''
                ],
                financial: [
                    'Cost sharing approach (50/50, proportional to income)',
                    'Date payment pattern (alternating, treating on special occasions)',
                    'Gift-giving expectations (budget ranges, occasions)',
                    'Financial boundaries (no shared accounts, loans)',
                    'Transparency about spending on shared activities',
                    'Vacation/trip cost division (planning method)',
                    'Supporting during financial hardship (boundaries)',
                    ''
                ]
            },
            zh: {
                connection: [
                    '对其他伴侣/交友软件的透明度（每周更新）',
                    '按计划见面的一致性（每周2-3次）',
                    '坦诚表达感受与边界（持续对话）',
                    '安全性行为协定（新伴侣使用屏障，每3个月检测）',
                    '定期检视我们的协定（每月一次）',
                    '情感责任（承担影响而非指责）',
                    '明确排他性期待（如无/部分/特定活动）',
                    '接受关系演变（包括关系降级）',
                    '尊重彼此情感连接的节奏',
                    ''
                ],
                emotional: [
                    '分享快乐与烦恼（每日/每周交流）',
                    '困难时期提供支持（根据需要，在能力范围内）',
                    '愿意展现脆弱面（按舒适节奏）',
                    '分享个人成长目标（每月反思）',
                    '与他人约会后的情绪沟通（24-48小时内）',
                    '尊重情感边界与空间（深入讨论前先询问）',
                    '讨论心理健康需求（主动沟通）',
                    '使用选定的亲密称呼（确立偏好）',
                    '庆祝彼此的成功（积极认可）',
                    '提供处理嫉妒情绪的无判断空间',
                    ''
                ],
                social: [
                    '与共同朋友相处（频率偏好）',
                    '在舒适情况下见元伴侣（无时间压力）',
                    '一起参加休闲集体活动/派对（每月）',
                    '社交媒体边界（对标记/发布的舒适度）',
                    '组队参加音乐节/演唱会（季节性）',
                    '对家人/工作圈的隐私边界',
                    '与朋友团体旅行（每年/半年一次）',
                    '如何向他人介绍对方（首选称谓）',
                    '不同社交场合中公开亲密行为的舒适度',
                    ''
                ],
                autonomy: [
                    '保持独立友谊圈（每周独处社交时间）',
                    '支持彼此个人目标/事业（积极鼓励）',
                    '独处与共处时间平衡（2:1比例等）',
                    '自由旅行或独立搬迁（沟通期望）',
                    '关系决策平等话语权（基于共识的方法）',
                    '个人空间需求（每周小时/天数）',
                    '独立决策边界（哪些需要商议）',
                    '对与他人的即兴计划的舒适度',
                    ''
                ],
                miscellaneous: [
                    '互相照顾宠物/植物（根据需要）',
                    '创意合作（音乐、艺术、项目）',
                    '分享歌单/书单（频率）',
                    '健康互助（共同锻炼、冥想练习）',
                    '技能分享与共同学习（每月技能交流）',
                    '精神或正念实践（尊重差异）',
                    '环境/生活方式兼容性（清洁、睡眠习惯）',
                    ''
                ],
                physical: [
                    '接吻/拥抱的舒适度和频率',
                    '手动/口腔性行为的边界和偏好',
                    '插入式性行为的频率和边界',
                    '探索特殊癖好/幻想（沟通过程）',
                    '互助自慰或玩具使用的舒适度',
                    '性传播感染检测时间表（每3-6个月）',
                    '屏障使用协定（与谁，哪些活动）',
                    '过夜频率（每周、每月等）',
                    '亲密行为中的同意与舒适度确认（语言/非语言）',
                    '事后关怀需求和偏好（触摸、空间、交谈）',
                    '公共场合的身体亲密度（边界）',
                    ''
                ],
                communication: [
                    '文字交流（每天、每隔几天等）',
                    '分开时的视频/语音通话（频率期望）',
                    '分享兴趣和日常经历（深度偏好）',
                    '与他人约会后的交流（细节程度、时机）',
                    '冲突解决方法（冷静期、形式）',
                    '日程共享（数字工具、更新频率）',
                    '诚实表达方式（直接、温和、书面）',
                    '回复时间期望（紧急与日常消息）',
                    '忙碌期间的沟通（最低交流）',
                    '表达需求与要求的语言区分',
                    ''
                ],
                quality: [
                    '固定约会夜（每周、两周一次）',
                    '即兴相聚（对临时计划的舒适度）',
                    '共同爱好实践（攀岩、游戏、音乐-频率）',
                    '周末旅行频率（每月、每季度）',
                    '家庭活动（烹饪、电影-每周轮换）',
                    '共同学习（工作坊、课程-每季度）',
                    '特殊场合庆祝（生日、纪念日）',
                    '一起尝试新体验（每月冒险）',
                    ''
                ],
                financial: [
                    '费用分担方式（50/50、按收入比例）',
                    '约会付款模式（轮流、特殊场合款待）',
                    '送礼期望（预算范围、场合）',
                    '财务边界（无共享账户、借贷）',
                    '共享活动支出的透明度',
                    '假期/旅行费用分配（规划方法）',
                    '财务困难时的支持（边界）',
                    ''
                ]
            }
        };

        const options = ['■', '♥', '?', '✘'];

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'zh' : 'en';
            updateLanguage();
            
            // Clear and reinitialize all sections
            Object.keys(menuData[currentLanguage]).forEach(sectionId => {
                const section = document.getElementById(sectionId);
                // Remove all items except the title
                const items = section.querySelectorAll('.item');
                items.forEach(item => item.remove());
                
                // Reinitialize with new language
                initializeSection(sectionId, menuData[currentLanguage][sectionId]);
            });
        }

        function updateLanguage() {
            const lang = translations[currentLanguage];
            
            document.getElementById('title').textContent = lang.title;
            document.getElementById('partner1').placeholder = lang.partner1;
            document.getElementById('partner2').placeholder = lang.partner2;
            document.getElementById('legend-must').textContent = lang.legendMust;
            document.getElementById('legend-like').textContent = lang.legendLike;
            document.getElementById('legend-maybe').textContent = lang.legendMaybe;
            document.getElementById('legend-off').textContent = lang.legendOff;
            document.getElementById('connection-title').textContent = lang.connectionTitle;
            document.getElementById('emotional-title').textContent = lang.emotionalTitle;
            document.getElementById('social-title').textContent = lang.socialTitle;
            document.getElementById('physical-title').textContent = lang.physicalTitle;
            document.getElementById('communication-title').textContent = lang.communicationTitle;
            document.getElementById('quality-title').textContent = lang.qualityTitle;
            document.getElementById('financial-title').textContent = lang.financialTitle;
            document.getElementById('autonomy-title').textContent = lang.autonomyTitle;
            document.getElementById('miscellaneous-title').textContent = lang.miscellaneousTitle;
            document.getElementById('export-pdf').textContent = lang.exportPdf;
            document.getElementById('export-excel').textContent = lang.exportExcel;
            document.getElementById('info-text').innerHTML = lang.infoText;
            document.getElementById('deescalation-text').innerHTML = lang.deescalationText;
            
            // Update button text
            document.querySelector('.language-toggle').textContent = currentLanguage === 'en' ? '中文' : 'English';
            
            // Update custom item placeholders
            document.querySelectorAll('.custom-item input').forEach(input => {
                input.placeholder = lang.customPlaceholder;
            });
        }

        function createItem(text, isCustom = false) {
            const item = document.createElement('div');
            item.className = 'item';

            if (isCustom) {
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = translations[currentLanguage].customPlaceholder;
                input.className = 'custom-item';
                item.appendChild(input);
                item.className = 'item custom-item';
                
                // 添加回车键处理
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        const newText = this.value.trim();
                        if (newText) {
                            // 创建一个新的普通条目
                            const newItem = createItem(newText);
                            // 将新条目插入到当前自定义条目之前
                            item.parentNode.insertBefore(newItem, item);
                            // 清空输入框
                            this.value = '';
                        }
                    }
                });
            } else {
                const textDiv = document.createElement('div');
                textDiv.className = 'item-text editable';
                textDiv.textContent = text;
                textDiv.style.textAlign = 'left'; // 设置文本左对齐
                
                // Add double-click to edit functionality
                textDiv.addEventListener('dblclick', function() {
                    const currentText = this.textContent;
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = currentText;
                    input.className = 'editing-input';
                    
                    // 设置输入框宽度与原文本相同
                    const textWidth = this.offsetWidth;
                    input.style.minWidth = textWidth + 'px';
                    
                    this.textContent = '';
                    this.appendChild(input);
                    input.focus();
                    
                    // 自动调整输入框大小
                    input.style.height = 'auto';
                    input.style.height = (input.scrollHeight) + 'px';
                    
                    function finishEditing() {
                        const newText = input.value.trim();
                        if (newText) {
                            textDiv.textContent = newText;
                        } else {
                            textDiv.textContent = currentText;
                        }
                    }
                    
                    input.addEventListener('blur', finishEditing);
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter') {
                            finishEditing();
                        }
                    });
                    
                    // 添加输入事件监听器以自动调整大小
                    input.addEventListener('input', function() {
                        this.style.height = 'auto';
                        this.style.height = (this.scrollHeight) + 'px';
                    });
                });
                
                item.appendChild(textDiv);
            }

            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options';

            options.forEach(option => {
                const optionSpan = document.createElement('span');
                optionSpan.className = 'option';
                optionSpan.textContent = option;
                optionSpan.onclick = function() {
                    optionsDiv.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                    optionSpan.classList.add('selected');
                };
                optionsDiv.appendChild(optionSpan);
            });

            item.appendChild(optionsDiv);
            return item;
        }

        function initializeSection(sectionId, items) {
            const section = document.getElementById(sectionId);
            items.forEach(item => {
                section.appendChild(createItem(item, item === ''));
            });
            
            // 移除以下加号按钮代码
            // const addButtonDiv = document.createElement('div');
            // addButtonDiv.className = 'add-item-button';
            // addButtonDiv.appendChild(addButton);
            // section.appendChild(addButtonDiv);
        }

        // Initialize all sections with English content
        Object.keys(menuData[currentLanguage]).forEach(sectionId => {
            initializeSection(sectionId, menuData[currentLanguage][sectionId]);
        });
    
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            const data = [];
    
            // Add headers
            data.push(['Section', 'Item', 'Selection']);
    
            // Add data from each section
            Object.keys(menuData[currentLanguage]).forEach(sectionId => {
                const section = document.getElementById(sectionId);
                const title = section.querySelector('h2').textContent;
                
                const items = section.querySelectorAll('.item');
                items.forEach(item => {
                    const selected = item.querySelector('.selected');
                    const text = item.querySelector('input')?.value || item.querySelector('.item-text')?.textContent?.trim();
                    const mark = selected ? selected.textContent : '';
                    
                    if (text) {
                        data.push([title, text, mark]);
                    }
                });
            });
    
            const ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'Relationship Menu');
            XLSX.writeFile(wb, 'relationship-menu.xlsx');
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
